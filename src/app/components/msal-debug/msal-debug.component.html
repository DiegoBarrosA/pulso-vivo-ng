<div class="msal-debug-container">
  <h2>ğŸ” MSAL Configuration Debug Panel</h2>
  
  <!-- Configuration Status -->
  <div class="debug-section">
    <h3>ğŸ“Š Configuration Status</h3>
    <div class="status-grid">
      <div class="status-item" [class.success]="validation.isValid" [class.error]="!validation.isValid">
        <span class="status-label">Valid Configuration:</span>
        <span class="status-value">{{ validation.isValid ? 'âœ… Yes' : 'âŒ No' }}</span>
      </div>
      <div class="status-item" [class.success]="isInitialized" [class.error]="!isInitialized">
        <span class="status-label">MSAL Initialized:</span>
        <span class="status-value">{{ isInitialized ? 'âœ… Yes' : 'âŒ No' }}</span>
      </div>
      <div class="status-item" [class.success]="isSpaConfig" [class.warning]="!isSpaConfig">
        <span class="status-label">SPA Configuration:</span>
        <span class="status-value">{{ isSpaConfig ? 'âœ… Yes' : 'âš ï¸ No' }}</span>
      </div>
      <div class="status-item">
        <span class="status-label">Accounts Found:</span>
        <span class="status-value">{{ accountsCount }}</span>
      </div>
    </div>
  </div>

  <!-- Errors -->
  <div class="debug-section" *ngIf="validation.errors.length > 0">
    <h3>âŒ Configuration Errors</h3>
    <ul class="error-list">
      <li *ngFor="let error of validation.errors" class="error-item">{{ error }}</li>
    </ul>
  </div>

  <!-- Warnings -->
  <div class="debug-section" *ngIf="validation.warnings.length > 0">
    <h3>âš ï¸ Configuration Warnings</h3>
    <ul class="warning-list">
      <li *ngFor="let warning of validation.warnings" class="warning-item">{{ warning }}</li>
    </ul>
  </div>

  <!-- Suggestions -->
  <div class="debug-section" *ngIf="validation.suggestions.length > 0">
    <h3>ğŸ’¡ Suggestions</h3>
    <ul class="suggestion-list">
      <li *ngFor="let suggestion of validation.suggestions" class="suggestion-item">{{ suggestion }}</li>
    </ul>
  </div>

  <!-- Current Configuration -->
  <div class="debug-section">
    <h3>âš™ï¸ Current Configuration</h3>
    <div class="config-grid">
      <div class="config-item">
        <span class="config-label">Client ID:</span>
        <span class="config-value">{{ currentConfig.clientId }}</span>
      </div>
      <div class="config-item">
        <span class="config-label">Tenant ID:</span>
        <span class="config-value">{{ extractedTenantId || 'Not found' }}</span>
      </div>
      <div class="config-item">
        <span class="config-label">Authority:</span>
        <span class="config-value">{{ currentConfig.authority }}</span>
      </div>
      <div class="config-item">
        <span class="config-label">Redirect URI:</span>
        <span class="config-value">{{ currentConfig.redirectUri }}</span>
      </div>
      <div class="config-item">
        <span class="config-label">Scopes:</span>
        <span class="config-value">{{ currentConfig.scopes | json }}</span>
      </div>
      <div class="config-item">
        <span class="config-label">Client Capabilities:</span>
        <span class="config-value">{{ currentConfig.clientCapabilities | json }}</span>
      </div>
      <div class="config-item">
        <span class="config-label">Current URL:</span>
        <span class="config-value">{{ currentUrl }}</span>
      </div>
      <div class="config-item">
        <span class="config-label">Current Origin:</span>
        <span class="config-value">{{ currentOrigin }}</span>
      </div>
    </div>
  </div>

  <!-- JWT Tokens Section -->
  <div class="debug-section">
    <h3>ğŸ« JWT Tokens</h3>
    <div class="button-group">
      <button class="debug-btn secondary" (click)="toggleTokenDisplay()">
        {{ showTokens ? 'ğŸ™ˆ Hide Tokens' : 'ğŸ‘ï¸ Show Tokens' }}
      </button>
      <button class="debug-btn secondary" (click)="refreshTokens()" *ngIf="showTokens">
        ğŸ”„ Refresh Tokens
      </button>
    </div>
    
    <div *ngIf="showTokens" class="tokens-container">
      <!-- Access Token -->
      <div class="token-section" *ngIf="currentTokens.accessToken">
        <h4>ğŸ”‘ Access Token</h4>
        <div class="token-actions">
          <button class="debug-btn small" (click)="copyTokenRaw('access')">
            ğŸ“‹ Copy Raw JWT
          </button>
          <button class="debug-btn small" (click)="copyTokenDecoded('access')">
            ğŸ“‹ Copy Decoded
          </button>
        </div>
        
        <div class="token-display">
          <h5>Raw JWT (First 100 chars):</h5>
          <div class="token-preview">
            {{ currentTokens.accessToken.substring(0, 100) }}...
          </div>
          
          <h5>Decoded Payload:</h5>
          <pre class="token-json">{{ currentTokens.accessTokenDecoded | json }}</pre>
        </div>
      </div>

      <!-- ID Token -->
      <div class="token-section" *ngIf="currentTokens.idToken">
        <h4>ğŸ†” ID Token</h4>
        <div class="token-actions">
          <button class="debug-btn small" (click)="copyTokenRaw('id')">
            ğŸ“‹ Copy Raw JWT
          </button>
          <button class="debug-btn small" (click)="copyTokenDecoded('id')">
            ğŸ“‹ Copy Decoded
          </button>
        </div>
        
        <div class="token-display">
          <h5>Raw JWT (First 100 chars):</h5>
          <div class="token-preview">
            {{ currentTokens.idToken.substring(0, 100) }}...
          </div>
          
          <h5>Decoded Payload:</h5>
          <pre class="token-json">{{ currentTokens.idTokenDecoded | json }}</pre>
        </div>
      </div>

      <!-- No Tokens Message -->
      <div *ngIf="!currentTokens.accessToken && !currentTokens.idToken" class="no-tokens">
        <p>No tokens available. Please login first using the "Test Login" button.</p>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="debug-section">
    <h3>ğŸ› ï¸ Debug Actions</h3>
    <div class="button-group">
      <button class="debug-btn primary" (click)="runFullDiagnostic()">
        ğŸ” Run Full Diagnostic
      </button>
      <button class="debug-btn secondary" (click)="validateConfiguration()">
        âœ… Validate Configuration
      </button>
      <button class="debug-btn secondary" (click)="testLogin()">
        ğŸ” Test Login
      </button>
      <button class="debug-btn secondary" (click)="downloadReport()">
        ğŸ“„ Download Report
      </button>
      <button class="debug-btn danger" (click)="clearCache()">
        ğŸ—‘ï¸ Clear Cache
      </button>
    </div>
  </div>

  <!-- Azure Portal Links -->
  <div class="debug-section">
    <h3>ğŸŒ Azure Portal Links</h3>
    <div class="link-group">
      <a [href]="azurePortalLinks.appRegistration" target="_blank" class="azure-link">
        ğŸ“± App Registration
      </a>
      <a [href]="azurePortalLinks.authentication" target="_blank" class="azure-link">
        ğŸ” Authentication Settings
      </a>
      <a [href]="azurePortalLinks.apiPermissions" target="_blank" class="azure-link">
        ğŸ”‘ API Permissions
      </a>
      <a [href]="azurePortalLinks.allApps" target="_blank" class="azure-link">
        ğŸ“‹ All App Registrations
      </a>
    </div>
  </div>

  <!-- Quick Fix Instructions -->
  <div class="debug-section" *ngIf="!validation.isValid">
    <h3>ğŸš€ Quick Fix Instructions</h3>
    <div class="instruction-box">
      <h4>Most Common Issue: App not configured as SPA</h4>
      <ol class="instruction-list">
        <li>Go to <a [href]="azurePortalLinks.authentication" target="_blank">Azure Portal Authentication</a></li>
        <li>Under "Platform configurations", remove any "Web" platform</li>
        <li>Click "Add a platform" â†’ "Single-page application"</li>
        <li>Add redirect URI: <code>{{ currentConfig.redirectUri }}</code></li>
        <li>Save changes and wait 2-3 minutes</li>
        <li>Refresh this page and test again</li>
      </ol>
    </div>
  </div>

  <!-- Error Log -->
  <div class="debug-section" *ngIf="errorLog.length > 0">
    <h3>ğŸ“‹ Recent Errors</h3>
    <div class="error-log">
      <div *ngFor="let error of errorLog" class="log-entry">
        <span class="log-timestamp">{{ error.timestamp | date:'HH:mm:ss' }}</span>
        <span class="log-message">{{ error.message }}</span>
      </div>
    </div>
  </div>
</div>